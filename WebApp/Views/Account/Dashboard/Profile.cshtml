@model WebApp.ViewModels.ProfileViewModel
@{
    ViewData["Title"] = "Мій профіль";
    Layout = "~/Views/Shared/_AccountLayout.cshtml";
}

<form class="card-body flex flex-col gap-5 p-10"
      method="post"
      asp-controller="Account"
      asp-action="EditProfile"
      autocomplete="off">

    <!-- HEADER -->
    <div class="text-center mb-2.5">
        <h3 class="text-lg font-medium text-gray-900 leading-none mb-2.5">
            Мій профіль
        </h3>
        <div class="text-2sm text-gray-700">
            Керуйте персональною інформацією
        </div>
    </div>

    <!-- AVATAR -->
    <div class="flex flex-col items-center gap-3">
        <div class="size-20 rounded-full bg-primary text-white flex items-center justify-center text-2xl font-semibold">
            @Model.Login.Substring(0,1).ToUpper()
        </div>
        <span class="text-2xs text-gray-500">
            Аватар (незабаром)
        </span>
    </div>

    <!-- LOGIN -->
    <div class="flex flex-col gap-1">
        <label class="form-label font-normal text-gray-900">
            Логін
        </label>
        <input class="input"
               name="Login"
               value="@Model.Login"
               type="text" />
        <span class="text-2xs text-gray-500">
            Відображається у профілі
        </span>
    </div>

    <!-- EMAIL (readonly) -->
    <div class="flex flex-col gap-1">
        <label class="form-label font-normal text-gray-900">
            Email
        </label>
        <input class="input bg-gray-100"
               value="@Model.Email"
               type="email"
               disabled />
    </div>

    <!-- PHONE -->
    <div class="flex flex-col gap-1">
        <label class="form-label font-normal text-gray-900">
            Телефон
        </label>
    <input class="input"
           name="PhoneNumber"
           value="@Model.PhoneNumber"
           placeholder="@(string.IsNullOrWhiteSpace(Model.PhoneNumber) 
               ? "Додати телефон" 
               : "+380XXXXXXXXX")"
           type="text" />

    </div>

    <!-- SECURITY TOGGLE -->
    <div class="flex items-center gap-2 mt-6">
        <span class="border-t border-gray-200 w-full"></span>
        <span class="text-2xs text-gray-500 font-medium uppercase">Безпека</span>
        <span class="border-t border-gray-200 w-full"></span>
    </div>

    

    <!-- BUTTON -->
    <button type="button"
            id="togglePasswordBtn"
            class="btn btn-light w-full">
        🔒 Змінити пароль
    </button>

    <!-- PASSWORD BLOCK (HIDDEN) -->
    <div id="passwordBlock" class="hidden flex flex-col gap-5 mt-4">

        <!-- CURRENT PASSWORD -->
        <div class="flex flex-col gap-1">
            <label class="form-label font-normal text-gray-900">
                Поточний пароль
            </label>

            <div class="input" data-toggle-password="true">
                <input asp-for="CurrentPassword"
                       placeholder="Введіть поточний пароль"
                       type="password" />
                <button class="btn btn-icon"
                        data-toggle-password-trigger="true"
                        type="button">
                    <i class="ki-filled ki-eye text-gray-500 toggle-password-active:hidden"></i>
                    <i class="ki-filled ki-eye-slash text-gray-500 hidden toggle-password-active:block"></i>
                </button>
            </div>
        </div>

        <!-- NEW PASSWORD -->
        <div class="flex flex-col gap-1">
            <label class="form-label font-normal text-gray-900">
                Новий пароль
            </label>

            <div class="input" data-toggle-password="true">
                <input asp-for="NewPassword"
                       placeholder="Новий пароль"
                       type="password" />
                <button class="btn btn-icon"
                        data-toggle-password-trigger="true"
                        type="button">
                    <i class="ki-filled ki-eye text-gray-500 toggle-password-active:hidden"></i>
                    <i class="ki-filled ki-eye-slash text-gray-500 hidden toggle-password-active:block"></i>
                </button>
            </div>
        </div>

        <!-- CONFIRM -->
        <div class="flex flex-col gap-1">
            <label class="form-label font-normal text-gray-900">
                Підтвердіть новий пароль
            </label>

            <div class="input" data-toggle-password="true">
                <input asp-for="ConfirmNewPassword"
                       placeholder="Повторіть пароль"
                       type="password" />
                <button class="btn btn-icon"
                        data-toggle-password-trigger="true"
                        type="button">
                    <i class="ki-filled ki-eye text-gray-500 toggle-password-active:hidden"></i>
                    <i class="ki-filled ki-eye-slash text-gray-500 hidden toggle-password-active:block"></i>
                </button>
            </div>
        </div>

        <!-- CANCEL CHANGE -->
        <button type="button"
                id="cancelPasswordBtn"
                class="btn btn-light">
            Скасувати зміну пароля
        </button>
    </div>



    <!-- ERRORS -->
    @if (!ViewData.ModelState.IsValid)
    {
        <div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded">
            @foreach (var error in ViewData.ModelState.Values.SelectMany(v => v.Errors))
            {
                <p>@error.ErrorMessage</p>
            }
        </div>
    }

        @if (TempData["PasswordChanged"] != null)
    {
        <div id="toast-success"
             class="fixed top-5 right-5 z-50 bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded shadow-lg flex items-center gap-2">
            <i class="ki-filled ki-check-circle"></i>
            <span>Пароль успішно змінено</span>
        </div>
    }

    <!-- ACTIONS -->
    @if (TempData["ProfileUpdated"] == null)
    {
        <div class="flex gap-3">
            <button type="submit"
                    class="btn btn-primary flex justify-center grow">
                Зберегти зміни
            </button>

            <button type="button"
                    onclick="window.history.back();"
                    class="btn btn-light flex justify-center grow">
                Скасувати
            </button>
        </div>
    }
    @if (TempData["ProfileUpdated"] != null)
    {
        <button type="button"
                onclick="window.location.href='/'"
                class="btn btn-success w-full mt-3">
            ← Готово
        </button>

    }
</form>


